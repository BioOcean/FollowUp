@namespace FollowUp.Components.Shared

@* 加载状态组件 - 统一的加载UI（支持骨架屏和多种模式） *@
<div class="loading-view fade-in" style="@GetContainerStyle()">
    @if (Mode == LoadingMode.Spinner)
    {
        <div class="spinner-container">
            @if (ShowSpinner)
            {
                <MudProgressCircular Color="@SpinnerColor"
                                     Indeterminate="true"
                                     Size="@SpinnerSize" />
            }

            @if (!string.IsNullOrEmpty(Message))
            {
                <MudText Class="loading-message"
                         Typo="@MessageTypo"
                         Color="@MessageColor">
                    @Message
                </MudText>
            }
        </div>
    }
    else if (Mode == LoadingMode.Skeleton)
    {
        <div class="skeleton-container" style="width:100%; padding:var(--spacing-lg);">
            @if (SkeletonType == SkeletonLayout.Card)
            {
                <div class="skeleton-card-layout">
                    <div class="skeleton skeleton-title" style="width:40%; height:24px; margin-bottom:16px;"></div>
                    <div class="skeleton-row">
                        <div class="skeleton skeleton-card" style="flex:1; height:120px;"></div>
                        <div class="skeleton skeleton-card" style="flex:1; height:120px;"></div>
                        <div class="skeleton skeleton-card" style="flex:1; height:120px;"></div>
                    </div>
                </div>
            }
            else if (SkeletonType == SkeletonLayout.List)
            {
                <div class="skeleton-list-layout">
                    @for (int i = 0; i < SkeletonCount; i++)
                    {
                        <div class="skeleton-list-item" style="animation-delay:@(i * 100)ms;">
                            <div class="skeleton skeleton-avatar"></div>
                            <div class="skeleton-content">
                                <div class="skeleton skeleton-text" style="width:60%;"></div>
                                <div class="skeleton skeleton-text" style="width:80%;"></div>
                            </div>
                        </div>
                    }
                </div>
            }
            else if (SkeletonType == SkeletonLayout.Chart)
            {
                <div class="skeleton-chart-layout">
                    <div class="skeleton skeleton-title" style="width:30%; height:20px; margin-bottom:20px;"></div>
                    <div class="skeleton" style="width:100%; height:200px; border-radius:var(--radius-md);"></div>
                </div>
            }
            else
            {
                <div class="skeleton-text-layout">
                    <div class="skeleton skeleton-text" style="width:90%;"></div>
                    <div class="skeleton skeleton-text" style="width:75%;"></div>
                    <div class="skeleton skeleton-text" style="width:85%;"></div>
                    <div class="skeleton skeleton-text" style="width:60%;"></div>
                </div>
            }
        </div>
    }
    else if (Mode == LoadingMode.Dots)
    {
        <div class="dots-container">
            <div class="loading-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
            @if (!string.IsNullOrEmpty(Message))
            {
                <MudText Class="loading-message"
                         Typo="@MessageTypo"
                         Color="@MessageColor">
                    @Message
                </MudText>
            }
        </div>
    }
    else if (Mode == LoadingMode.Pulse)
    {
        <div class="pulse-container">
            <div class="pulse-ring"></div>
            <MudIcon Icon="@Icons.Material.Filled.HealthAndSafety"
                     Color="@SpinnerColor"
                     Size="Size.Large"
                     Class="pulse-icon" />
            @if (!string.IsNullOrEmpty(Message))
            {
                <MudText Class="loading-message"
                         Typo="@MessageTypo"
                         Color="@MessageColor">
                    @Message
                </MudText>
            }
        </div>
    }

    @if (ChildContent != null)
    {
        <div class="mt-3">
            @ChildContent
        </div>
    }
</div>

@code {
    /// <summary>
    /// 加载模式
    /// </summary>
    [Parameter]
    public LoadingMode Mode { get; set; } = LoadingMode.Spinner;

    /// <summary>
    /// 加载提示消息
    /// </summary>
    [Parameter]
    public string Message { get; set; } = "正在加载数据...";

    /// <summary>
    /// 是否显示加载动画
    /// </summary>
    [Parameter]
    public bool ShowSpinner { get; set; } = true;

    /// <summary>
    /// 加载动画颜色
    /// </summary>
    [Parameter]
    public Color SpinnerColor { get; set; } = Color.Primary;

    /// <summary>
    /// 加载动画大小
    /// </summary>
    [Parameter]
    public Size SpinnerSize { get; set; } = Size.Medium;

    /// <summary>
    /// 容器高度
    /// </summary>
    [Parameter]
    public string Height { get; set; } = "300px";

    /// <summary>
    /// 消息文本样式
    /// </summary>
    [Parameter]
    public Typo MessageTypo { get; set; } = Typo.body1;

    /// <summary>
    /// 消息文本颜色
    /// </summary>
    [Parameter]
    public Color MessageColor { get; set; } = Color.Default;

    /// <summary>
    /// 骨架屏布局类型
    /// </summary>
    [Parameter]
    public SkeletonLayout SkeletonType { get; set; } = SkeletonLayout.Text;

    /// <summary>
    /// 骨架屏列表项数量
    /// </summary>
    [Parameter]
    public int SkeletonCount { get; set; } = 3;

    /// <summary>
    /// 自定义内容
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    private string GetContainerStyle()
    {
        if (Mode == LoadingMode.Skeleton)
        {
            return $"min-height:{Height};";
        }
        return $"display:flex; justify-content:center; align-items:center; flex-direction:column; height:{Height};";
    }

    public enum LoadingMode
    {
        Spinner,    // 传统旋转加载
        Skeleton,   // 骨架屏
        Dots,       // 点状加载
        Pulse       // 脉冲医疗图标
    }

    public enum SkeletonLayout
    {
        Text,       // 文本骨架
        Card,       // 卡片骨架
        List,       // 列表骨架
        Chart       // 图表骨架
    }
}

