@namespace FollowUp.Components.Modules.ProjectManagement.Components
@inherits BasePage

@* 科室信息卡片 - 采用 NTCare 原始设计 *@
<MudPaper Class="pa-2 mb-4">
    <div class="d-flex justify-content-between">
        <MudButton Variant="Variant.Text"
                   Color="Color.Primary"
                   OnClick="@PageToDepartment"
                   Class="pa-0"
                   Style="min-width:unset;">
            <MudText Color="Color.Primary" Typo="Typo.h6">@(Department.display_name ?? Department.name)</MudText>
        </MudButton>
    </div>
    <div class="d-flex mt-4 mb-8">
        <div class="div-block width33">
            <MudText Typo="Typo.button" Color="Color.Primary">患者数量</MudText>
            <MudText Class="fw-bold">@PatientCount 个</MudText>
        </div>
        <div class="div-block width33">
            <MudText Typo="Typo.button" Color="Color.Primary">随访任务</MudText>
            <MudText Class="fw-bold">@FollowupTaskCount 个</MudText>
        </div>
        <div class="div-block width33">
            <MudText Typo="Typo.button" Color="Color.Primary">本月随访率</MudText>
            <MudText Class="fw-bold">@FollowupRate.ToString("0")%</MudText>
        </div>
    </div>
    @if (Department.form_project != null && Department.form_project.Any())
    {
        <MudText Class="fw-bold mt-2">科室内课题</MudText>
        <MudGrid Class="mt-0">
            @foreach (var project in Department.form_project)
            {
                <MudItem xs="4">
                    <MudButton Variant="Variant.Text"
                               Color="Color.Primary"
                               OnClick="@(() => PageToProject(project.id))"
                               Class="pa-0 span_text"
                               Style="min-width:unset;">
                        @(project.display_name ?? project.name)
                    </MudButton>
                </MudItem>
            }
        </MudGrid>
    }
</MudPaper>

@code {
    [Parameter] public sys_department Department { get; set; } = default!;
    [Parameter] public DepartmentSummaryDto? Summary { get; set; }

    private int PatientCount => Summary?.PatientCount ?? 0;
    private int FollowupTaskCount => Summary?.FollowupTaskCount ?? 0;
    private double FollowupRate => Summary?.FollowupRate ?? 0;

    private void PageToDepartment()
    {
        inj_navigationManager.NavigateTo($"/departmentMain?departmentId={Department.id}");
    }

    private void PageToProject(Guid projectId)
    {
        inj_navigationManager.NavigateTo($"/projectMain?projectId={projectId}");
    }
}
